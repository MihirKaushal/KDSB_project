---
title: "Crime in Chicago"
author: "Mihir Kaushal"
output: 
  html_document:
    css: styles.css  # Optional: Customize CSS for better control over layout
    fig_width: 100%
    fig_height: 100%
    fig_caption: yes
    keep_md: true  # Keep the intermediate Markdown file for better control
execute: 
  echo: false 
  message: false 
  warning: false 
---

```{r}
#| label: setup 
library(tidyverse)
library(ggplot2)
library(dplyr)
library(scales)
library(repr)
library(knitr)
library(readr)

```


Chicago has been known as one of the most dangerous cities in America. Many people believe that crimes have only been getting worse over the years. For example: motor theft in Chicago in 2022 is more than twice the amount in 2021 and the motor theft cases in 2023 were the highest they have every been in 20 years. The data is from data.cityofchicago.org and they update the data every day. I used this data to make graphs to see how crimes in Chicago have changed over the years and if COVID had an impact on crime rates. The data originally had over 8 million rows, so I had to filter some of them out and only keep the information that I wanted to analyze. Through the graphs, I saw many relationships that were unexpected. For example, I did not know that the narcotics related crimes had been going down. I was also shocked to see how few people were arrested because of motor theft. 


```{r}
#| label: motor_theft_graph 

motor_theft_data <- read_csv("motor_theft_chicago_2001-now.csv")

p <- ggplot(motor_theft_data, aes(x = Year, fill = Arrest)) + 
     geom_bar(alpha = 0.7, color = "black", width = 1, stat = "count") + 
     scale_y_continuous(labels = comma) + 
     scale_x_continuous(breaks = c(2001:2024)) +  
     theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
     labs(title = "Auto Theft in Chicago from 2001 to Present", 
          subtitle = "Most cases did not lead to arrests and the overall number of cases \n were decreasing but increase again in 2022.", 
          x = "Year", 
          y = "Number of Cases", 
          caption = "Source: data.cityofchicago.org") + 
     theme(plot.title = element_text(size = 36, color = "white"), 
  plot.subtitle = element_text(size = 28, color = "white"),
  axis.title.x = element_text(size = 24, color = "white"), 
  axis.title.y = element_text(size = 24, color = "white"), 
  axis.text.x = element_text(size = 16, color = "white"), 
  axis.text.y = element_text(size = 16, color = "white"), 
  plot.caption = element_text(size = 24, color = "white"),
  legend.text = element_text(size = 24, color = "white"), 
  legend.title = element_text(size = 24, color = "white"),
  legend.key.size = unit(2, "cm"), 
  legend.background = element_rect(fill = "black"),
  plot.margin = margin(2, 2, 2, 2, "cm"),
  panel.background = element_rect(fill = "black"),
  plot.background = element_rect(fill = "black", colour = "darkgray"))

ggsave("motor_theft_graph.png", plot = p, width = 18, height = 12, units = "in", limitsize = FALSE)

knitr::include_graphics("motor_theft_graph.png")
```


```{r}
#| label: narcotics_graph 

narcotics_data <- read_csv("narcotics_chicago_2001-now.csv")

p <- ggplot(narcotics_data, aes(x = Year, fill = Arrest)) + 
     geom_bar(alpha = 0.7, color = "black", width = 1, stat = "count") + 
     scale_y_continuous(labels = comma) + 
     scale_x_continuous(breaks = c(2001:2024)) +  
     theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
     labs(title = "Narcotics Related Crimes in Chicago from 2001 to Present", 
          subtitle = "Most cases did lead to arrests and the overall number of cases are decreasing.", 
          x = "Year", 
          y = "Number of Cases", 
          caption = "Source: data.cityofchicago.org") + 
     theme(plot.title = element_text(size = 36, color = "white"), 
  plot.subtitle = element_text(size = 28, color = "white"),
  axis.title.x = element_text(size = 24, color = "white"), 
  axis.title.y = element_text(size = 24, color = "white"), 
  axis.text.x = element_text(size = 16, color = "white"), 
  axis.text.y = element_text(size = 16, color = "white"), 
  plot.caption = element_text(size = 24, color = "white"),
  legend.text = element_text(size = 24, color = "white"), 
  legend.title = element_text(size = 24, color = "white"),
  legend.key.size = unit(2, "cm"), 
  legend.background = element_rect(fill = "black"),
  plot.margin = margin(2, 2, 2, 2, "cm"),
  panel.background = element_rect(fill = "black"),
  plot.background = element_rect(fill = "black", colour = "darkgray"))

ggsave("narcotics_graph.png", plot = p, width = 18, height = 12, units = "in", limitsize = FALSE)

knitr::include_graphics("narcotics_graph.png")
```


```{r}
#| label: all_crimes_graph 

# Load the data and convert column names to valid R names
all_crimes_data <- read_csv("all_crimes_chicago_2019-2021.csv")
names(all_crimes_data) <- make.names(names(all_crimes_data))

# Define primary types to display individually
primary_types_to_display <- c("THEFT", "BATTERY", "CRIMINAL DAMAGE", "NARCOTICS", "ASSAULT")

# Create a new column with adjusted primary types
all_crimes_data <- all_crimes_data %>%
  mutate(Adjusted.Primary.Type = ifelse(Primary.Type %in% primary_types_to_display, Primary.Type, "Other Offence"))

# Create the plot
p <- ggplot(all_crimes_data, aes(x = Year, fill = Adjusted.Primary.Type)) + 
     geom_bar(alpha = 0.7, color = "black", width = 1, stat = "count") + 
     scale_y_continuous(labels = comma) + 
     scale_x_continuous(breaks = c(2019:2021)) +  
     theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
     labs(title = "All Crimes in Chicago from 2019 to 2021", 
          subtitle = "Crimes grouped by primary type with others combined as 'Other Offence'.", 
          x = "Year", 
          y = "Number of Cases", 
          caption = "Source: data.cityofchicago.org") + 
     theme(plot.title = element_text(size = 36, color = "white"), 
           plot.subtitle = element_text(size = 28, color = "white"),
           axis.title.x = element_text(size = 24, color = "white"), 
           axis.title.y = element_text(size = 24, color = "white"), 
           axis.text.x = element_text(size = 16, color = "white"), 
           axis.text.y = element_text(size = 16, color = "white"), 
           plot.caption = element_text(size = 24, color = "white"),
           legend.text = element_text(size = 24, color = "white"), 
           legend.title = element_text(size = 24, color = "white"),
           legend.key.size = unit(2, "cm"), 
           legend.background = element_rect(fill = "black"),
           plot.margin = margin(2, 2, 2, 2, "cm"),
           panel.background = element_rect(fill = "black"),
           plot.background = element_rect(fill = "black", colour = "darkgray"))

# Save the plot
ggsave("all_crimes_graph.png", plot = p, width = 18, height = 12, units = "in", limitsize = FALSE)

# Display the plot
knitr::include_graphics("all_crimes_graph.png")
```
